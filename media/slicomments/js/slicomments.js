(function(p){var r=new Class({options:{},initialize:function(h,i){this.textarea=p(h);this.counter=p(i);this.textarea.store("cC",this);this.options.maxLength=h.get("data-maxlength")||500;var g=this.update_counter.bind(this);!Browser.chrome&&!Browser.safari&&this.textarea.addEvents({blur:g,change:g,focus:g,keydown:g,keypress:g,keyup:g,paste:g});this.textarea.addListener("input",g);g()},update_counter:function(){var h=this.options.maxLength-this.textarea.value.length;
this.counter.set("text",h);5>=h?this.counter.setStyle("color","#900"):this.counter.setStyle("color",null);0>h?this.textarea.form.getElement("button").set("disabled",!0):this.textarea.form.getElement("button").set("disabled",!1)}});window.addEvent("domready",function(){var h=p("comments");h.removeClass("no-js");var i=p("comments_counter"),g=p("comments_list"),f=function(a){return function(b){b.stop();(new Request({url:this.get("href"),format:"raw",method:"get",onSuccess:a.bind(this),onFailure:function(a){alert(a.responseText)}})).send()}},
j=f(function(a){var b=this.getParent(".content-container").getElement(".metadata"),b=b.getElement(".rating")||(new Element("span.rating")).inject(b),a=(b.get("text").toInt()||0)+a.toInt();b.set("text",0<a?"+"+a:a).removeClass("(?:positive|negative)").addClass(0<a?"positive":"negative")});h.addEvents({"click:relay(.comment-delete)":f(function(){this.getParent("li.comment").nix(!0);i.set("text",i.get("text").toInt()-1)}),"click:relay(.comment-like)":j,"click:relay(.comment-dislike)":j,"click:relay(.comment-flag)":f(function(a){alert(a)}),
"click:relay(.slicomments-spoiler button)":function(){var a=this.getParent();a.hasClass("spoiler-hide")?(a.removeClass("spoiler-hide"),this.set("text",this.get("data-hide"))):(a.addClass("spoiler-hide"),this.set("text",this.get("data-show")))},"click:relay(.cancel-reply)":function(a){a.stop();this.getParent(".comment").getElement(".comment-reply").getParent().setStyle("display",null);this.getParent("form").destroy()}});var k=h.getElement("form");if(k){f=k.getElement("textarea");(j=k.getElement(".chars-count"))&&
new r(f,j);var j=1==k.get("data-logged")?!0:!1,c=document.getElement("html").get("lang");try{c=c.split("-"),c[1]=c[1].toUpperCase(),c=c.join("-")}catch(d){}Locale.list().contains(c)&&Locale.use(c);var m=f.getDimensions().y;f.addEvents({focus:function(){0==this.value.length&&this.tween("height",m,100)},blur:function(){0==this.value.length&&this.tween("height",m)}});c="placeholder"in document.createElement("input");(!f.get("disabled")||!c)&&$$(".comments_form_inputs li label").setStyle("display","none");
c||(c={offset:{x:7,y:4}},new OverText(f,{positionOptions:c,textOverride:f.get("placeholder")}),j||(new OverText(k.name,{positionOptions:c,textOverride:k.name.get("placeholder")}),new OverText(k.email,{positionOptions:c,textOverride:k.email.get("placeholder")})));h.addEvent("click:relay(.comment-submit)",function(a){a.stop();var a=this.form,b=a.retrieve("validator");b||(b=new Form.Validator.Inline(a,{scrollToErrorsOnSubmit:!1,evaluateFieldsOnChange:!1,evaluateFieldsOnBlur:!1}),a.store("validator",
b));if(b.validate()){(new Request.HTML({url:this.form.get("action"),format:"raw",method:"post",data:this.form,onSuccess:function(a){a[0].inject(g,this.form.get("data-position"));i.set("text",i.get("text").toInt()+1);this.form.hasClass("reply-form")?this.form.destroy():(this.form.reset(),(a=this.form.text.retrieve("cC"))&&a.update_counter(),this.form.text.fireEvent("blur"));OverText.update();j&&(clearInterval(j),c.set("disabled",null),this.set("html",h))}.bind(this),onFailure:function(a){alert(a.responseText)}})).send();
var c=this,d=1,h=c.get("html"),f=c.get("data-sending")||"Sending";this.set("disabled","disabled");this.set("html",f);var j=function(){var a=Array(d++%4+1).join(".");c.set("html",f+a)}.periodical(1E3/3)}});h.addEvent("click:relay(.comment-reply)",function(a){a.stop();a=k.clone();a.addClass("reply-form");a.getElements(".validation-advice").destroy();var b=this.getParent(".comment"),c=b.getElement(".metadata .author").get("text").trim();a.inject(b.getElement(".clr"),"before");b=a.getElement("textarea").addClass("init");
b.set("value","@"+c+" ").setCaretPosition("end");(a=a.getElement(".chars-count"))&&new r(b,a);this.getParent().setStyle("display","none")});var n;if(!j&&(n=k.getElement(".profile-image"))){var l=n.get("src");~l.indexOf("gravatar.com")&&(l=l.toURI(),p("comments_form_email").addEvent("change",function(){n.set("src",l.set("file",t.digest_s(this.get("value")))+"")}))}}});
/**
 * md5.js
 * Copyright (c) 2011, Yoshinori Kohyama (http://algobit.jp/)
 * all rights reserved.
 */
var t={digest:function(h){function i(a,b,c){return a&b|~a&c}function g(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function j(a,
b,c){return b^(a|~c)}function k(a){return[a&255,a>>>8&255,a>>>16&255,a>>>24&255]}function c(a,b,c,d,e,f,h,g){a[0]+=g(b[0],c[0],d[0])+s[e]+h;a[0]=a[0]<<f|a[0]>>>32-f;a[0]+=b[0]}var d,m,n,l,a,b,e,p,r,s,q;d=h.length;h.push(128);a=56-h.length&63;for(m=0;m<a;m++)h.push(0);k(8*d).forEach(function(a){h.push(a)});[0,0,0,0].forEach(function(a){h.push(a)});d=[1732584193];a=[4023233417];b=[2562383102];e=[271733878];for(m=0;m<h.length;m+=64){s=[];for(n=0;64>n;n+=4)l=m+n,s.push(h[l]|h[l+1]<<8|h[l+2]<<16|h[l+3]<<
24);n=d[0];l=a[0];p=b[0];r=e[0];c(d,a,b,e,0,7,3614090360,i);c(e,d,a,b,1,12,3905402710,i);c(b,e,d,a,2,17,606105819,i);c(a,b,e,d,3,22,3250441966,i);c(d,a,b,e,4,7,4118548399,i);c(e,d,a,b,5,12,1200080426,i);c(b,e,d,a,6,17,2821735955,i);c(a,b,e,d,7,22,4249261313,i);c(d,a,b,e,8,7,1770035416,i);c(e,d,a,b,9,12,2336552879,i);c(b,e,d,a,10,17,4294925233,i);c(a,b,e,d,11,22,2304563134,i);c(d,a,b,e,12,7,1804603682,i);c(e,d,a,b,13,12,4254626195,i);c(b,e,d,a,14,17,2792965006,i);c(a,b,e,d,15,22,1236535329,i);c(d,
a,b,e,1,5,4129170786,g);c(e,d,a,b,6,9,3225465664,g);c(b,e,d,a,11,14,643717713,g);c(a,b,e,d,0,20,3921069994,g);c(d,a,b,e,5,5,3593408605,g);c(e,d,a,b,10,9,38016083,g);c(b,e,d,a,15,14,3634488961,g);c(a,b,e,d,4,20,3889429448,g);c(d,a,b,e,9,5,568446438,g);c(e,d,a,b,14,9,3275163606,g);c(b,e,d,a,3,14,4107603335,g);c(a,b,e,d,8,20,1163531501,g);c(d,a,b,e,13,5,2850285829,g);c(e,d,a,b,2,9,4243563512,g);c(b,e,d,a,7,14,1735328473,g);c(a,b,e,d,12,20,2368359562,g);c(d,a,b,e,5,4,4294588738,f);c(e,d,a,b,8,11,2272392833,
f);c(b,e,d,a,11,16,1839030562,f);c(a,b,e,d,14,23,4259657740,f);c(d,a,b,e,1,4,2763975236,f);c(e,d,a,b,4,11,1272893353,f);c(b,e,d,a,7,16,4139469664,f);c(a,b,e,d,10,23,3200236656,f);c(d,a,b,e,13,4,681279174,f);c(e,d,a,b,0,11,3936430074,f);c(b,e,d,a,3,16,3572445317,f);c(a,b,e,d,6,23,76029189,f);c(d,a,b,e,9,4,3654602809,f);c(e,d,a,b,12,11,3873151461,f);c(b,e,d,a,15,16,530742520,f);c(a,b,e,d,2,23,3299628645,f);c(d,a,b,e,0,6,4096336452,j);c(e,d,a,b,7,10,1126891415,j);c(b,e,d,a,14,15,2878612391,j);c(a,b,
e,d,5,21,4237533241,j);c(d,a,b,e,12,6,1700485571,j);c(e,d,a,b,3,10,2399980690,j);c(b,e,d,a,10,15,4293915773,j);c(a,b,e,d,1,21,2240044497,j);c(d,a,b,e,8,6,1873313359,j);c(e,d,a,b,15,10,4264355552,j);c(b,e,d,a,6,15,2734768916,j);c(a,b,e,d,13,21,1309151649,j);c(d,a,b,e,4,6,4149444226,j);c(e,d,a,b,11,10,3174756917,j);c(b,e,d,a,2,15,718787259,j);c(a,b,e,d,9,21,3951481745,j);d[0]+=n;a[0]+=l;b[0]+=p;e[0]+=r}q=[];k(d[0]).forEach(function(a){q.push(a)});k(a[0]).forEach(function(a){q.push(a)});k(b[0]).forEach(function(a){q.push(a)});
k(e[0]).forEach(function(a){q.push(a)});return q},digest_s:function(h){var i=[],g,f;for(g=0;g<h.length;g++)i.push(h.charCodeAt(g));i=t.digest(i);f="";i.forEach(function(g){for(h=g.toString(16);2>h.length;)h="0"+h;f+=h});return f}}})(document.id);